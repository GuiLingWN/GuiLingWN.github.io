(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{373:function(s,t,a){"use strict";a.r(t);var r=a(27),n=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx-日志分析与处理技巧"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-日志分析与处理技巧"}},[s._v("#")]),s._v(" Nginx 日志分析与处理技巧")]),s._v(" "),t("p",[s._v("Nginx 日志是系统运维和问题排查的重要工具。通过分析访问日志和错误日志，我们可以了解系统的运行状况、用户行为以及潜在问题。本文将介绍一些实用的 Nginx 日志分析和处理技巧。")]),s._v(" "),t("h2",{attrs:{id:"日志分析基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志分析基础"}},[s._v("#")]),s._v(" 日志分析基础")]),s._v(" "),t("p",[s._v("Nginx 访问日志记录了每个请求的详细信息，通过分析这些信息可以了解接口访问情况、用户行为等。")]),s._v(" "),t("h3",{attrs:{id:"使用-awk-统计接口访问次数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-awk-统计接口访问次数"}},[s._v("#")]),s._v(" 使用 awk 统计接口访问次数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计接口访问次数并排序")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{split($7, a, \"?\"); print a[1]}'")]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nr")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配指定接口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$7 ~ /^\\/saas_test\\// {split($7, a, \"?\"); print a[1]}'")]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nr")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 限制时间区间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'$7 ~ /^\\/saas_test\\// && $4 >= "[12/Jul/2024:15:22:00" && $4 <= "[12/Jul/2024:15:24:00" {split($7, a, "?"); print a[1]}\'')]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nr")]),s._v("\n")])])]),t("h3",{attrs:{id:"多时间段日志分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多时间段日志分析"}},[s._v("#")]),s._v(" 多时间段日志分析")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存3个时间段统计到文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'$7 ~ /^\\/saas_test\\// && $4 >= "[15/Jul/2024:13:05:00" && $4 <= "[15/Jul/2024:13:15:00" {split($7, a, "?"); print a[1]}\'')]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" period1.log\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'$7 ~ /^\\/saas_test\\// && $4 >= "[15/Jul/2024:13:50:00" && $4 <= "[15/Jul/2024:13:59:00" {split($7, a, "?"); print a[1]}\'')]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" period2.log\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'$7 ~ /^\\/saas_test\\// && $4 >= "[15/Jul/2024:14:50:00" && $4 <= "[15/Jul/2024:14:59:00" {split($7, a, "?"); print a[1]}\'')]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" period3.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提取 URL 并排序")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),s._v(" period1.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" period1_urls.log\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),s._v(" period2.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" period2_urls.log\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),s._v(" period3.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" period3_urls.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找出共同的 URL")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("comm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-12")]),s._v(" period1_urls.log period2_urls.log period3_urls.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" common_urls.log\n")])])]),t("h3",{attrs:{id:"合并多个日志文件分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#合并多个日志文件分析"}},[s._v("#")]),s._v(" 合并多个日志文件分析")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 合并多个文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" access1.log access2.log access3.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" access.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 筛选 nginx 接口到相同文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'$4 >= "[15/Jul/2024:13:05:00" && $4 <= "[15/Jul/2024:13:15:00" && $7 ~ /\\/saas_test\\// {split($7, a, "?"); print a[1]}\'')]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" periodAll.log\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'$4 >= "[15/Jul/2024:13:50:00" && $4 <= "[15/Jul/2024:13:59:00" && $7 ~ /\\/saas_test\\// {split($7, a, "?"); print a[1]}\'')]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" periodAll.log\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'$4 >= "[15/Jul/2024:14:50:00" && $4 <= "[15/Jul/2024:14:59:00" && $7 ~ /\\/saas_test\\// {split($7, a, "?"); print a[1]}\'')]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" periodAll.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计相同行排序，出现3次即为全部都有")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{count[$0]++} END {for (line in count) print count[line], line}'")]),s._v(" periodAll.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nr")]),s._v("\n")])])]),t("h2",{attrs:{id:"日志轮转"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志轮转"}},[s._v("#")]),s._v(" 日志轮转")]),s._v(" "),t("p",[s._v("为了防止日志文件过大，建议配置日志轮转。Nginx 支持通过 logrotate 工具进行日志轮转管理。")]),s._v(" "),t("p",[s._v("更多关于日志轮转的详细信息，可以参考相关文档。")]),s._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("通过合理分析 Nginx 日志，我们可以：")]),s._v(" "),t("ol",[t("li",[s._v("了解接口访问情况，发现热点接口")]),s._v(" "),t("li",[s._v("分析用户行为，优化用户体验")]),s._v(" "),t("li",[s._v("发现潜在问题，及时处理异常")]),s._v(" "),t("li",[s._v("进行容量规划，合理分配资源")])]),s._v(" "),t("p",[s._v("掌握这些日志分析技巧，可以大大提高系统运维效率和问题排查速度。")])])}),[],!1,null,null,null);t.default=n.exports}}]);