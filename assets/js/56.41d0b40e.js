(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{369:function(a,s,t){"use strict";t.r(s);var r=t(27),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"防止-手滑-惨案-为你的-linux-服务器配置-safe-rm-拦截-rm-rf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#防止-手滑-惨案-为你的-linux-服务器配置-safe-rm-拦截-rm-rf"}},[a._v("#")]),a._v(" 防止“手滑”惨案：为你的 Linux 服务器配置 safe-rm 拦截 rm -rf")]),a._v(" "),s("p",[a._v("在 Linux 系统管理中，"),s("code",[a._v("rm -rf")]),a._v(" 无疑是一个让人又爱又恨的命令。它的强大在于能干净利落地删除文件和目录，而它的危险也在于此——一旦误操作，尤其是在生产服务器上，后果不堪设想。为了防止这种“手滑”导致的灾难，我们可以引入一个简单而有效的小工具："),s("code",[a._v("safe-rm")]),a._v("。它能像一个安全卫士，在我们执行删除命令时，拦截掉针对重要目录的危险操作。")]),a._v(" "),s("h2",{attrs:{id:"safe-rm-是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#safe-rm-是什么"}},[a._v("#")]),a._v(" "),s("code",[a._v("safe-rm")]),a._v(" 是什么？")]),a._v(" "),s("p",[s("code",[a._v("safe-rm")]),a._v(" 并不是 "),s("code",[a._v("rm")]),a._v(" 命令的替代品，而是一个“包装器”（wrapper）。当你执行 "),s("code",[a._v("rm")]),a._v(" 命令时，实际上会先调用 "),s("code",[a._v("safe-rm")]),a._v("。它会检查你想要删除的路径是否在一个预设的“黑名单”中。如果是，"),s("code",[a._v("safe-rm")]),a._v(" 会拒绝执行并给出警告；如果不是，它才会去调用真正的 "),s("code",[a._v("rm")]),a._v(" 命令来完成删除。")]),a._v(" "),s("h2",{attrs:{id:"安装与配置步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装与配置步骤"}},[a._v("#")]),a._v(" 安装与配置步骤")]),a._v(" "),s("p",[a._v("下面是在服务器上安装和配置 "),s("code",[a._v("safe-rm")]),a._v(" 的完整步骤。")]),a._v(" "),s("h3",{attrs:{id:"_1-下载-safe-rm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载-safe-rm"}},[a._v("#")]),a._v(" 1. 下载 "),s("code",[a._v("safe-rm")])]),a._v(" "),s("p",[a._v("我们可以从其官方发布页面下载源码包。这里以 0.12 版本为例：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://launchpad.net/safe-rm/trunk/0.12/+download/safe-rm-0.12.tar.gz\n")])])]),s("h3",{attrs:{id:"_2-解压并安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-解压并安装"}},[a._v("#")]),a._v(" 2. 解压并安装")]),a._v(" "),s("p",[a._v("下载完成后，解压并将 "),s("code",[a._v("safe-rm")]),a._v(" 可执行文件复制到系统路径下。一个好的实践是放在 "),s("code",[a._v("/usr/local/bin")]),a._v(" 目录，以便于管理。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" safe-rm-0.12.tar.gz\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将可执行文件复制到bin目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" safe-rm-0.12/safe-rm /usr/local/bin/\n")])])]),s("h3",{attrs:{id:"_3-替换系统-rm-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-替换系统-rm-命令"}},[a._v("#")]),a._v(" 3. 替换系统 "),s("code",[a._v("rm")]),a._v(" 命令")]),a._v(" "),s("p",[a._v("这里的核心技巧是创建一个符号链接，让我们在终端输入的 "),s("code",[a._v("rm")]),a._v(" 命令指向我们刚刚安装的 "),s("code",[a._v("safe-rm")]),a._v("。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建一个名为rm的符号链接，指向safe-rm")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 注意：这里的目标是 /usr/local/bin/rm，不是 /bin/rm")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ln")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" /usr/local/bin/safe-rm /usr/local/bin/rm\n")])])]),s("h3",{attrs:{id:"_4-修改环境变量-path"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改环境变量-path"}},[a._v("#")]),a._v(" 4. 修改环境变量 "),s("code",[a._v("PATH")])]),a._v(" "),s("p",[a._v("为了确保系统优先找到我们放在 "),s("code",[a._v("/usr/local/bin")]),a._v(" 下的 "),s("code",[a._v("rm")]),a._v("（实际上是 "),s("code",[a._v("safe-rm")]),a._v("），我们需要将 "),s("code",[a._v("/usr/local/bin")]),a._v(" 这个路径放到 "),s("code",[a._v("PATH")]),a._v(" 环境变量的最前面。")]),a._v(" "),s("p",[a._v("编辑 "),s("code",[a._v("/etc/profile")]),a._v(" 文件：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nano")]),a._v(" /etc/profile\n")])])]),s("p",[a._v("在文件末尾（"),s("code",[a._v("export PATH")]),a._v(" 语句之前）追加以下内容：")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/usr/local/bin:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),a._v("\n")])])]),s("p",[a._v("修改后，执行 "),s("code",[a._v("source /etc/profile")]),a._v(" 或重新登录以使配置生效。")]),a._v(" "),s("h3",{attrs:{id:"_5-创建保护名单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建保护名单"}},[a._v("#")]),a._v(" 5. 创建保护名单")]),a._v(" "),s("p",[a._v("现在，我们需要告诉 "),s("code",[a._v("safe-rm")]),a._v(" 哪些目录是需要被保护的。创建一个配置文件 "),s("code",[a._v("/etc/safe-rm.conf")]),a._v("，并在其中列出你不想被误删除的绝对路径。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建并编辑配置文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nano")]),a._v(" /etc/safe-rm.conf\n")])])]),s("p",[a._v("下面是一个示例配置，你可以根据自己服务器的实际情况进行修改，添加需要保护的路径：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# 保护根目录\n/\n/*\n\n# 保护重要的系统目录\n/etc\n/etc/*\n/usr\n/usr/local\n/usr/local/bin\n/usr/local/bin/*\n\n# 保护重要的数据目录\n/data\n/data/mysql\n/data/mysql/datadir\n/data/mysql/datadir/*\n")])])]),s("h2",{attrs:{id:"效果演示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#效果演示"}},[a._v("#")]),a._v(" 效果演示")]),a._v(" "),s("p",[a._v("配置完成后，当你尝试删除一个被保护的目录时，"),s("code",[a._v("safe-rm")]),a._v(" 会拦截这次操作，并提示你该路径是受保护的，从而避免了误删除。")]),a._v(" "),s("p",[a._v("例如，当你执行 "),s("code",[a._v("rm -rf /etc")]),a._v(" 时，终端会显示类似 "),s("code",[a._v("safe-rm: skipping /etc")]),a._v(" 的信息，操作被安全地阻止了。")]),a._v(" "),s("p",[s("img",{attrs:{src:"attachments/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%A7%E8%A1%8Crm-rf%E5%91%BD%E4%BB%A4%E6%8B%A6%E6%88%AA_image_0.gif",alt:"safe-rm拦截演示"}})]),a._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),s("p",[a._v("通过安装 "),s("code",[a._v("safe-rm")]),a._v("，我们为高危的 "),s("code",[a._v("rm")]),a._v(" 命令增加了一层有效的防护。这个小工具配置简单，却能在关键时刻避免无法挽回的损失。对于多用户环境或重要的生产服务器来说，这是一个非常值得推荐的安全实践。")]),a._v(" "),s("h3",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://blog.csdn.net/qq_34330286/article/details/103456200",target:"_blank",rel:"noopener noreferrer"}},[a._v("CSDN - Linux服务器执行rm -rf 命令拦截"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);