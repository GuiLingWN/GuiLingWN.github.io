(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{372:function(s,t,a){"use strict";a.r(t);var e=a(27),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx-反向代理路径处理与子域名配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-反向代理路径处理与子域名配置"}},[s._v("#")]),s._v(" Nginx 反向代理路径处理与子域名配置")]),s._v(" "),t("p",[s._v("在使用 Nginx 作为反向代理服务器时，路径处理和子域名配置是两个常见的需求。本文将详细介绍如何正确配置这些功能。")]),s._v(" "),t("h2",{attrs:{id:"反向代理路径处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反向代理路径处理"}},[s._v("#")]),s._v(" 反向代理路径处理")]),s._v(" "),t("p",[s._v("在配置 Nginx 反向代理时，路径的处理方式对请求的转发结果有重要影响。")]),s._v(" "),t("h3",{attrs:{id:"路径匹配与转发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#路径匹配与转发"}},[s._v("#")]),s._v(" 路径匹配与转发")]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ ^/play(/?)(.*)")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:9000/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("这个配置的含义是：将 "),t("code",[s._v("/play/xx")]),s._v(" 的请求转发到 "),t("code",[s._v("http://127.0.0.1:9000/xx")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"更简洁的配置方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更简洁的配置方式"}},[s._v("#")]),s._v(" 更简洁的配置方式")]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /play")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:9000/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("注意结尾的 "),t("code",[s._v("/")]),s._v(" 符号的重要性。")]),s._v(" "),t("h3",{attrs:{id:"路径处理规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#路径处理规则"}},[s._v("#")]),s._v(" 路径处理规则")]),s._v(" "),t("p",[s._v("当 "),t("code",[s._v("proxy_pass")]),s._v(" 指令后面加上 "),t("code",[s._v("/")]),s._v(" 时，表示使用绝对根路径，Nginx 不会将 location 中匹配的路径部分传递给后端：")]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不传递匹配路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://backend/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递匹配路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("例如：")]),s._v(" "),t("ul",[t("li",[s._v("请求 "),t("code",[s._v("/play/test")]),s._v("，使用 "),t("code",[s._v("proxy_pass http://127.0.0.1:9000/;")]),s._v(" 会转发到 "),t("code",[s._v("http://127.0.0.1:9000/test")])]),s._v(" "),t("li",[s._v("请求 "),t("code",[s._v("/play/test")]),s._v("，使用 "),t("code",[s._v("proxy_pass http://127.0.0.1:9000;")]),s._v(" 会转发到 "),t("code",[s._v("http://127.0.0.1:9000/play/test")])])]),s._v(" "),t("h2",{attrs:{id:"子域名访问对应目录配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#子域名访问对应目录配置"}},[s._v("#")]),s._v(" 子域名访问对应目录配置")]),s._v(" "),t("p",[s._v("通过 Nginx 的变量功能，可以实现根据子域名访问对应目录的功能。")]),s._v(" "),t("h3",{attrs:{id:"方法一-使用正则表达式提取子域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法一-使用正则表达式提取子域名"}},[s._v("#")]),s._v(" 方法一：使用正则表达式提取子域名")]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" *.saas.shhuih.cn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用正则表达式提取子域名")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(" ~* (.*)\\.(.*)\\.(.*)\\.(.*))")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$subdomain")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html/web/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$subdomain")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"方法二-直接使用主机名变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法二-直接使用主机名变量"}},[s._v("#")]),s._v(" 方法二：直接使用主机名变量")]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" *.saas.shhuih.cn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html/web/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"日志处理定时任务脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志处理定时任务脚本"}},[s._v("#")]),s._v(" 日志处理定时任务脚本")]),s._v(" "),t("p",[s._v("为了防止日志文件过大，可以设置定时任务定期处理和轮转日志文件。")]),s._v(" "),t("p",[s._v("Windows 环境下的批处理脚本示例：")]),s._v(" "),t("div",{staticClass:"language-batch extra-class"},[t("pre",{pre:!0,attrs:{class:"language-batch"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),t("span",{pre:!0,attrs:{class:"token command"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" off")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token command"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cd")]),s._v(" C:\\nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token command"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("today")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%date:~2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%%date:~5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%%date:~8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%_%")]),s._v("time:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%%time:~3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token command"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("C:\\nginx\\logs\\access\\"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%today%")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token command"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("move")]),s._v(" C:\\nginx\\logs\\access.log "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%path%")]),s._v(".log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token command"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("nginx")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter attr-name"}},[s._v("-s")]),s._v(" reload")]),s._v("\n")])])]),t("p",[s._v("该脚本的作用：")]),s._v(" "),t("ol",[t("li",[s._v("切换到 Nginx 目录")]),s._v(" "),t("li",[s._v("生成当前日期时间戳")]),s._v(" "),t("li",[s._v("创建日志备份路径")]),s._v(" "),t("li",[s._v("移动当前访问日志到备份位置")]),s._v(" "),t("li",[s._v("重新加载 Nginx 配置，生成新的日志文件")])]),s._v(" "),t("p",[s._v("Nginx 安装后的文件位置：")]),s._v(" "),t("ul",[t("li",[s._v("/usr/sbin/nginx：主程序")]),s._v(" "),t("li",[s._v("/etc/nginx：存放配置文件")]),s._v(" "),t("li",[s._v("/usr/share/nginx：存放静态文件")]),s._v(" "),t("li",[s._v("/var/log/nginx：存放日志")])]),s._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("通过合理配置 Nginx 的反向代理路径处理和子域名访问，可以实现灵活的请求转发和资源访问。在实际应用中，需要注意：")]),s._v(" "),t("ol",[t("li",[s._v("正确理解 "),t("code",[s._v("proxy_pass")]),s._v(" 指令中斜杠的作用")]),s._v(" "),t("li",[s._v("合理使用 Nginx 变量提取和处理请求信息")]),s._v(" "),t("li",[s._v("定期处理日志文件，防止磁盘空间不足")]),s._v(" "),t("li",[s._v("根据实际需求选择合适的配置方式")])]),s._v(" "),t("p",[s._v("这些配置技巧可以帮助我们更好地利用 Nginx 的强大功能，构建高效稳定的 Web 服务。")])])}),[],!1,null,null,null);t.default=n.exports}}]);