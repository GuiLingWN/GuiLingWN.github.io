(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{400:function(a,s,t){"use strict";t.r(s);var r=t(27),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"华为云-rds-数据库-qp-格式备份恢复指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#华为云-rds-数据库-qp-格式备份恢复指南"}},[a._v("#")]),a._v(" 华为云 RDS 数据库 .qp 格式备份恢复指南")]),a._v(" "),s("p",[a._v("在使用华为云 RDS 数据库时，可能会遇到需要恢复 .qp 格式备份文件的情况。本文将详细介绍如何处理和恢复华为云 RDS 的 .qp 格式备份文件。")]),a._v(" "),s("h2",{attrs:{id:"qp-格式备份文件恢复步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#qp-格式备份文件恢复步骤"}},[a._v("#")]),a._v(" .qp 格式备份文件恢复步骤")]),a._v(" "),s("h3",{attrs:{id:"基本恢复流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本恢复流程"}},[a._v("#")]),a._v(" 基本恢复流程")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建备份目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" backup\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压 .qp 文件")]),a._v("\nxbstream "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-x")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" ./backup_file.qp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" ./backup/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压备份文件")]),a._v("\nxtrabackup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--parallel")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--decompress")]),a._v(" --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 准备备份数据")]),a._v("\nxtrabackup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--prepare")]),a._v(" --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 恢复数据到目标目录")]),a._v("\nxtrabackup --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/path/to/my.cnf --copy-back --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup\n")])])]),s("h3",{attrs:{id:"使用-docker-进行恢复的补救方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-进行恢复的补救方案"}},[a._v("#")]),a._v(" 使用 Docker 进行恢复的补救方案")]),a._v(" "),s("p",[a._v("当直接恢复遇到问题时，可以使用 Docker 安装相同版本的 MySQL 进行恢复：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建备份目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" backup\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压 .qp 文件")]),a._v("\nxbstream "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-x")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" ./全备文件.qp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" ./backup/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压备份文件")]),a._v("\nxtrabackup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--parallel")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--decompress")]),a._v(" --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除 .qp 文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" ./backup/ "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'*.qp'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("xargs")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 准备备份数据")]),a._v("\nxtrabackup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--prepare")]),a._v(" --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用系统安装的 MySQL 环境恢复解压数据到 MySQL 数据目录 /var/lib/mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# my.cnf 使用 Docker 拷贝出来的")]),a._v("\nxtrabackup --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/root/file/my.cnf --copy-back --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 停止 Docker MySQL 容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" stop mysql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 备份 Docker 的 MySQL 数据目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" /opt/data/mysql /opt/data/mysql_bak \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用恢复的 MySQL 数据目录替换 Docker 的 MySQL 数据目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" /var/lib/mysql /opt/data/mysql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动 Docker MySQL 容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" start mysql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导出指定数据库")]),a._v("\nmysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p123123")]),a._v(" saas "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" saas.sql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 从容器拷贝文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" mysql:/tmp/saas.sql /root/file/saas.sql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 压缩文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zcvf")]),a._v(" backup.tar.gz saas.sql\n")])])]),s("h3",{attrs:{id:"在目标服务器上恢复数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在目标服务器上恢复数据"}},[a._v("#")]),a._v(" 在目标服务器上恢复数据")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 数据库服务器直接拷贝压缩文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" root@192.168.2.10:/root/file/backup.tar.gz ./\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" backup.tar.gz\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 拷贝文件到数据库镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" ./saas.sql mysql:/tmp/saas.sql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导入数据库")]),a._v("\nmysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p123456")]),a._v(" saas "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" saas.sql\n")])])]),s("h2",{attrs:{id:"原始恢复方案-可能因版本问题无法启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原始恢复方案-可能因版本问题无法启动"}},[a._v("#")]),a._v(" 原始恢复方案（可能因版本问题无法启动）")]),a._v(" "),s("p",[a._v("在某些情况下，直接使用系统安装的 MySQL 进行恢复可能会因为版本原因导致 MySQL 无法启动：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建备份目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" backup\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压 .qp 文件")]),a._v("\nxbstream "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-x")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" ./全备文件.qp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" ./backup/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压备份文件")]),a._v("\nxtrabackup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--parallel")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--decompress")]),a._v(" --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除 .qp 文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" ./backup/ "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'*.qp'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("xargs")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 准备备份数据")]),a._v("\nxtrabackup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--prepare")]),a._v(" --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 停止 MySQL 服务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" mysql stop\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 备份 MySQL 数据目录（MySQL 8 的 data 目录就是 /var/lib/mysql 目录）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" /var/lib/mysql /var/lib/mysql_bak\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建新的 MySQL 数据目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /var/lib/mysql\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" mysql:mysql /var/lib/mysql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 恢复解压数据到 MySQL 数据目录")]),a._v("\nxtrabackup --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/mysql/my.cnf --copy-back --target-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./backup\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置目录权限")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" mysql:mysql /var/lib/mysql/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动 MySQL 服务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" mysql start\n")])])]),s("h2",{attrs:{id:"使用-docker-运行-mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-运行-mysql"}},[a._v("#")]),a._v(" 使用 Docker 运行 MySQL")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 拉取指定版本的 MySQL 镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull mysql:8.0.21\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 运行 MySQL 容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3308")]),a._v(":3306 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123123")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /opt/data/mysql:/var/lib/mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" mysql mysql:8.0.21\n")])])]),s("h2",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[a._v("#")]),a._v(" 注意事项")]),a._v(" "),s("ol",[s("li",[a._v("在进行恢复操作前，务必备份现有数据")]),a._v(" "),s("li",[a._v("确保使用的 MySQL 版本与备份文件兼容")]),a._v(" "),s("li",[a._v("恢复过程中注意文件权限设置")]),a._v(" "),s("li",[a._v("恢复完成后验证数据完整性")]),a._v(" "),s("li",[a._v("在生产环境中操作前，建议先在测试环境验证恢复流程")])]),a._v(" "),s("p",[a._v("通过以上步骤，可以成功恢复华为云 RDS 数据库的 .qp 格式备份文件。在实际操作中，可能会遇到各种问题，需要根据具体情况进行调整。")])])}),[],!1,null,null,null);s.default=e.exports}}]);