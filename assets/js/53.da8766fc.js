(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{366:function(t,a,s){"use strict";s.r(a);var e=s(27),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"让服务器时间保持精准-使用-ntpdate-同步网络时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#让服务器时间保持精准-使用-ntpdate-同步网络时间"}},[t._v("#")]),t._v(" 让服务器时间保持精准：使用 ntpdate 同步网络时间")]),t._v(" "),a("p",[t._v("在服务器管理中，时间的准确性至关重要。无论是日志记录的精确性、定时任务的可靠执行，还是分布式系统中节点间的协调，都离不开一个统一而精准的时间基准。如果服务器的系统时间出现偏差，可能会引发一系列难以排查的奇怪问题。")]),t._v(" "),a("p",[t._v("幸运的是，Linux 系统提供了一个简单而有效的工具——"),a("code",[t._v("ntpdate")]),t._v("，它可以帮助我们从网络时间协议（NTP）服务器获取标准时间，并校准本地系统时钟。")]),t._v(" "),a("h2",{attrs:{id:"什么是-ntp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-ntp"}},[t._v("#")]),t._v(" 什么是 NTP？")]),t._v(" "),a("p",[t._v("NTP (Network Time Protocol) 是一种用于在计算机网络中同步时钟的协议。互联网上有许多公开的 NTP 服务器，它们提供高精度的时间源，任何人都可以连接并同步自己的设备时间。")]),t._v(" "),a("h2",{attrs:{id:"使用-ntpdate-同步时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-ntpdate-同步时间"}},[t._v("#")]),t._v(" 使用 "),a("code",[t._v("ntpdate")]),t._v(" 同步时间")]),t._v(" "),a("p",[t._v("下面是在基于 Debian/Ubuntu 的系统上安装和使用 "),a("code",[t._v("ntpdate")]),t._v(" 的完整步骤。")]),t._v(" "),a("h3",{attrs:{id:"_1-安装-ntpdate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-ntpdate"}},[t._v("#")]),t._v(" 1. 安装 "),a("code",[t._v("ntpdate")])]),t._v(" "),a("p",[t._v("通常情况下，"),a("code",[t._v("ntpdate")]),t._v(" 可能不是系统默认安装的。我们可以通过 "),a("code",[t._v("apt")]),t._v(" 包管理器来安装它。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 首先更新软件包列表")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 然后安装 ntpdate")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ntpdate\n")])])]),a("h3",{attrs:{id:"_2-手动同步时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-手动同步时间"}},[t._v("#")]),t._v(" 2. 手动同步时间")]),t._v(" "),a("p",[t._v("安装完成后，我们就可以立即执行一次手动同步了。"),a("code",[t._v("ntpdate")]),t._v(" 命令后面需要跟一个 NTP 服务器的地址。这里推荐几个常用的公共 NTP 服务器：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ntp.ubuntu.com")]),t._v(" (Ubuntu 官方服务器)")]),t._v(" "),a("li",[a("code",[t._v("ntp.aliyun.com")]),t._v(" (阿里云服务器)")]),t._v(" "),a("li",[a("code",[t._v("pool.ntp.org")]),t._v(" (一个全球性的 NTP 服务器集群)")])]),t._v(" "),a("p",[t._v("执行同步命令：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 与 Ubuntu 的 NTP 服务器同步")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ntpdate ntp.ubuntu.com\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者与阿里云的 NTP 服务器同步")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ntpdate ntp.aliyun.com\n")])])]),a("p",[t._v("执行成功后，你会看到类似下面的输出，其中包含了时间调整的偏移量：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("16 Oct 14:30:00 ntpdate[12345]: adjust time server 91.189.94.4 offset -0.001234 sec\n")])])]),a("p",[t._v("这表示你的系统时间已经被成功校准。")]),t._v(" "),a("h3",{attrs:{id:"_3-设置定时任务-实现自动同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-设置定时任务-实现自动同步"}},[t._v("#")]),t._v(" 3. 设置定时任务，实现自动同步")]),t._v(" "),a("p",[t._v("手动同步只能解决一时的问题，服务器运行久了，时间还是会因为硬件时钟的微小误差而再次产生偏差。为了“一劳永逸”，最好的方法是设置一个定时任务（Cron Job），让系统每天自动同步一次时间。")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("编辑当前用户的定时任务列表")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("crontab")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("使用 "),a("code",[t._v("sudo crontab -e")]),t._v(" 是为了确保该任务在 "),a("code",[t._v("root")]),t._v(" 用户下执行，因为修改系统时间需要管理员权限。")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("添加同步任务")]),t._v("：")]),t._v(" "),a("p",[t._v("在打开的编辑器中，添加下面这行内容：")]),t._v(" "),a("div",{staticClass:"language-crontab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 每天凌晨 0 点 0 分执行一次时间同步\n0 0 * * * /usr/sbin/ntpdate ntp.ubuntu.com > /dev/null 2>&1\n")])])]),a("p",[a("strong",[t._v("这行命令的解释")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("0 0 * * *")]),t._v("：这是 Cron 的时间表达式，表示“每天的 0 点 0 分”。")]),t._v(" "),a("li",[a("code",[t._v("/usr/sbin/ntpdate")]),t._v("：使用 "),a("code",[t._v("ntpdate")]),t._v(" 的绝对路径，这是在 Cron 任务中推荐的做法，以避免 "),a("code",[t._v("PATH")]),t._v(" 环境变量问题。")]),t._v(" "),a("li",[a("code",[t._v("ntp.ubuntu.com")]),t._v("：指定的 NTP 服务器。")]),t._v(" "),a("li",[a("code",[t._v("> /dev/null 2>&1")]),t._v("：这部分的意思是将命令的所有输出（标准输出和错误输出）都重定向到“黑洞”("),a("code",[t._v("/dev/null")]),t._v(")，以避免产生不必要的日志邮件或输出信息。")])])])]),t._v(" "),a("p",[t._v("保存并退出编辑器后，这个定时任务就设置好了。从此，你的服务器每天都会悄悄地进行一次时间校准，时刻与标准时间保持一致。")]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("通过 "),a("code",[t._v("ntpdate")]),t._v(" 和 "),a("code",[t._v("crontab")]),t._v(" 的简单组合，我们就能轻松地为 Linux 服务器建立起一个稳定可靠的自动时间同步机制。这个简单的配置，却能为整个系统的稳定运行提供坚实的保障。")])])}),[],!1,null,null,null);a.default=n.exports}}]);