(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{385:function(a,t,s){"use strict";s.r(t);var e=s(27),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"frp服务端配置与部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#frp服务端配置与部署"}},[a._v("#")]),a._v(" FRP服务端配置与部署")]),a._v(" "),t("p",[a._v("FRP服务端是整个内网穿透系统的核心，负责接收客户端连接并转发请求。本文将介绍如何配置和部署FRP服务端。")]),a._v(" "),t("h2",{attrs:{id:"安装frp服务端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装frp服务端"}},[a._v("#")]),a._v(" 安装FRP服务端")]),a._v(" "),t("p",[a._v("可以从FRP的GitHub发布页面下载适用于您系统的版本：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 下载并解压（示例为Linux AMD64版本）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/fatedier/frp/releases/download/v0.51.3/frp_0.51.3_linux_amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" frp_0.51.3_linux_amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" frp_0.51.3_linux_amd64\n")])])]),t("h2",{attrs:{id:"基础配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础配置"}},[a._v("#")]),a._v(" 基础配置")]),a._v(" "),t("p",[a._v("FRP服务端的核心配置文件是"),t("code",[a._v("frps.ini")]),a._v("，最基础的配置如下：")]),a._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("common")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("bind_port")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("12450")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vhost_http_port")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8081")]),a._v("\n")])])]),t("h3",{attrs:{id:"常用配置项说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用配置项说明"}},[a._v("#")]),a._v(" 常用配置项说明")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("bind_port")]),a._v("：服务端监听的端口，用于与客户端建立连接")]),a._v(" "),t("li",[t("code",[a._v("vhost_http_port")]),a._v("：HTTP协议的虚拟主机端口")])]),a._v(" "),t("h3",{attrs:{id:"安全配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全配置"}},[a._v("#")]),a._v(" 安全配置")]),a._v(" "),t("p",[a._v("为了提高安全性，建议添加以下配置：")]),a._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("common")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("bind_port")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("12450")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vhost_http_port")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8081")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("token")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("your_secure_token")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("max_pool_count")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("5")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("authentication_timeout")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("900")]),a._v("\n")])])]),t("p",[a._v("配置说明：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("token")]),a._v("：客户端连接时需要提供的令牌")]),a._v(" "),t("li",[t("code",[a._v("max_pool_count")]),a._v("：每个代理的最大连接池数量")]),a._v(" "),t("li",[t("code",[a._v("authentication_timeout")]),a._v("：认证超时时间（秒）")])]),a._v(" "),t("h3",{attrs:{id:"日志配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志配置"}},[a._v("#")]),a._v(" 日志配置")]),a._v(" "),t("p",[a._v("为了便于排查问题，可以配置日志输出：")]),a._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("common")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("bind_port")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("12450")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vhost_http_port")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8081")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_file")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("./frps.log")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_level")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("info")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_max_days")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3")]),a._v("\n")])])]),t("h2",{attrs:{id:"启动服务端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务端"}},[a._v("#")]),a._v(" 启动服务端")]),a._v(" "),t("p",[a._v("配置完成后，可以通过以下命令启动FRP服务端：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("./frps "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" frps.ini\n")])])]),t("h2",{attrs:{id:"后台运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后台运行"}},[a._v("#")]),a._v(" 后台运行")]),a._v(" "),t("p",[a._v("为了使FRP服务端在后台持续运行，可以使用以下命令：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" ./frps "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" frps.ini "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])])]),t("h2",{attrs:{id:"systemd服务配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#systemd服务配置"}},[a._v("#")]),a._v(" systemd服务配置")]),a._v(" "),t("p",[a._v("在Linux系统中，推荐使用systemd管理FRP服务端：")]),a._v(" "),t("p",[a._v("创建服务文件：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /usr/lib/systemd/system/frps.service\n")])])]),t("p",[a._v("服务配置内容：")]),a._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("Unit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Frp Server Service")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("After")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("network.target")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("Service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("simple")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nobody")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("on-failure")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("RestartSec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("5s")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/root/frp/frps -c /root/frp/frps.ini")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ExecReload")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/root/frp/frps reload -c /root/frp/frps.ini")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("Install")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("multi-user.target")]),a._v("\n")])])]),t("p",[a._v("启用并启动服务：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("systemctl daemon-reload\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" frps\nsystemctl start frps\n")])])]),t("h2",{attrs:{id:"防火墙配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防火墙配置"}},[a._v("#")]),a._v(" 防火墙配置")]),a._v(" "),t("p",[a._v("确保服务器防火墙开放了必要的端口：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开放FRP服务端端口（示例）")]),a._v("\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12450")]),a._v("/tcp\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8081")]),a._v("/tcp\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--reload")]),a._v("\n")])])]),t("h2",{attrs:{id:"配合nginx使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配合nginx使用"}},[a._v("#")]),a._v(" 配合Nginx使用")]),a._v(" "),t("p",[a._v("为了更好地管理和使用FRP穿透的服务，通常会配合Nginx反向代理：")]),a._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("listen")]),a._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server_name")]),a._v(" *.frp.your_domain")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("location")]),a._v(" /")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_pass")]),a._v("  http://127.0.0.1:8081/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$proxy_add_x_forwarded_for")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$http_host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h2",{attrs:{id:"监控与维护"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控与维护"}},[a._v("#")]),a._v(" 监控与维护")]),a._v(" "),t("h3",{attrs:{id:"查看运行状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看运行状态"}},[a._v("#")]),a._v(" 查看运行状态")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("systemctl status frps\n")])])]),t("h3",{attrs:{id:"查看日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看日志"}},[a._v("#")]),a._v(" 查看日志")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tail")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /path/to/frps.log\n")])])]),t("h3",{attrs:{id:"重新加载配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重新加载配置"}},[a._v("#")]),a._v(" 重新加载配置")]),a._v(" "),t("p",[a._v("当修改配置文件后，可以重新加载而无需重启服务：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("./frps reload "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" frps.ini\n")])])]),t("h2",{attrs:{id:"故障排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#故障排查"}},[a._v("#")]),a._v(" 故障排查")]),a._v(" "),t("p",[a._v("常见问题及解决方案：")]),a._v(" "),t("ol",[t("li",[t("p",[t("strong",[a._v("客户端无法连接")])]),a._v(" "),t("ul",[t("li",[a._v("检查服务端端口是否开放")]),a._v(" "),t("li",[a._v("确认防火墙规则")]),a._v(" "),t("li",[a._v("验证token是否正确")])])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("域名无法访问")])]),a._v(" "),t("ul",[t("li",[a._v("检查DNS解析是否正确")]),a._v(" "),t("li",[a._v("确认Nginx配置")]),a._v(" "),t("li",[a._v("验证custom_domains配置")])])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("连接不稳定")])]),a._v(" "),t("ul",[t("li",[a._v("检查网络状况")]),a._v(" "),t("li",[a._v("调整max_pool_count参数")]),a._v(" "),t("li",[a._v("查看日志分析错误信息")])])])]),a._v(" "),t("h2",{attrs:{id:"性能优化建议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#性能优化建议"}},[a._v("#")]),a._v(" 性能优化建议")]),a._v(" "),t("ol",[t("li",[a._v("根据实际需求调整连接池大小")]),a._v(" "),t("li",[a._v("合理设置超时时间")]),a._v(" "),t("li",[a._v("定期清理日志文件")]),a._v(" "),t("li",[a._v("监控系统资源使用情况")])])])}),[],!1,null,null,null);t.default=r.exports}}]);