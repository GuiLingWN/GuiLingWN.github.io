(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{417:function(t,s,a){"use strict";a.r(s);var n=a(27),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"springboot核心注解与事务管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#springboot核心注解与事务管理"}},[t._v("#")]),t._v(" SpringBoot核心注解与事务管理")]),t._v(" "),s("p",[t._v("SpringBoot通过大量注解简化了开发配置，本文整理了常用的核心注解和事务传播机制，帮助更好地理解和使用SpringBoot。")]),t._v(" "),s("h2",{attrs:{id:"常用注解整理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用注解整理"}},[t._v("#")]),t._v(" 常用注解整理")]),t._v(" "),s("h3",{attrs:{id:"json序列化注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#json序列化注解"}},[t._v("#")]),t._v(" JSON序列化注解")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@JsonInclude")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsonInclude"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NON_NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("该注解可以将实体类中值为null的属性在序列化时自动忽略，避免返回给前端过多的null字段。")]),t._v(" "),s("h3",{attrs:{id:"lombok注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lombok注解"}},[t._v("#")]),t._v(" Lombok注解")]),t._v(" "),s("p",[t._v("Lombok通过注解自动生成Java样板代码，大大简化了实体类的编写：")]),t._v(" "),s("h4",{attrs:{id:"基础注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础注解"}},[t._v("#")]),t._v(" 基础注解")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("@Getter/@Setter")]),t._v("：生成getter/setter方法")]),t._v(" "),s("ul",[s("li",[t._v("作用在类上：为所有成员变量生成方法")]),t._v(" "),s("li",[t._v("作用在成员变量上：只为该变量生成方法")]),t._v(" "),s("li",[t._v("可以设定访问权限和懒加载等属性")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("@ToString")]),t._v("：生成toString()方法")]),t._v(" "),s("ul",[s("li",[t._v("可通过of属性限定显示某些字段")]),t._v(" "),s("li",[t._v("可通过exclude属性排除某些字段")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("@EqualsAndHashCode")]),t._v("：生成equals()和hashCode()方法")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("@NonNull")]),t._v("：标识字段不能为空，为空时抛出空指针异常")])])]),t._v(" "),s("h4",{attrs:{id:"构造方法注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构造方法注解"}},[t._v("#")]),t._v(" 构造方法注解")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("@NoArgsConstructor")]),t._v("：生成无参构造方法")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("@RequiredArgsConstructor")]),t._v("：为final字段和@NonNull标注的字段生成构造方法")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("@AllArgsConstructor")]),t._v("：生成包含所有字段的构造方法")])])]),t._v(" "),s("h4",{attrs:{id:"组合注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组合注解"}},[t._v("#")]),t._v(" 组合注解")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("@Data")]),t._v("：组合注解，包含以下功能：\n"),s("ul",[s("li",[t._v("@ToString")]),t._v(" "),s("li",[t._v("@EqualsAndHashCode")]),t._v(" "),s("li",[t._v("@Getter")]),t._v(" "),s("li",[t._v("@Setter")]),t._v(" "),s("li",[t._v("@RequiredArgsConstructor")]),t._v(" "),s("li",[t._v("注意：final属性不会生成setter方法")])])])]),t._v(" "),s("h4",{attrs:{id:"日志注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志注解"}},[t._v("#")]),t._v(" 日志注解")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("@Log")]),t._v("：自动生成日志变量\n"),s("ul",[s("li",[t._v("针对不同日志框架有不同的注解，如@Slf4j、@Log4j2等")])])])]),t._v(" "),s("h3",{attrs:{id:"使用示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用示例"}},[t._v("#")]),t._v(" 使用示例")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Data")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@NoArgsConstructor")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@AllArgsConstructor")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@JsonInclude")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsonInclude"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NON_NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@NonNull")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"spring事务传播行为"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring事务传播行为"}},[t._v("#")]),t._v(" Spring事务传播行为")]),t._v(" "),s("p",[t._v("事务传播行为定义了事务方法之间相互调用时，事务应该如何传播。Spring提供了7种事务传播行为：")]),t._v(" "),s("h3",{attrs:{id:"事务传播行为类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事务传播行为类型"}},[t._v("#")]),t._v(" 事务传播行为类型")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("传播行为")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("PROPAGATION_REQUIRED")])]),t._v(" "),s("td",[t._v("如果当前没有事务，就新建一个事务；如果已存在事务，加入到这个事务中。"),s("strong",[t._v("这是最常见的选择")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("PROPAGATION_SUPPORTS")])]),t._v(" "),s("td",[t._v("支持当前事务，如果当前没有事务，就以非事务方式执行")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("PROPAGATION_MANDATORY")])]),t._v(" "),s("td",[t._v("使用当前的事务，如果当前没有事务，就抛出异常")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("PROPAGATION_REQUIRES_NEW")])]),t._v(" "),s("td",[t._v("新建事务，如果当前存在事务，把当前事务挂起")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("PROPAGATION_NOT_SUPPORTED")])]),t._v(" "),s("td",[t._v("以非事务方式执行操作，如果当前存在事务，就把当前事务挂起")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("PROPAGATION_NEVER")])]),t._v(" "),s("td",[t._v("以非事务方式执行，如果当前存在事务，则抛出异常")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("PROPAGATION_NESTED")])]),t._v(" "),s("td",[t._v("如果当前存在事务，则在嵌套事务内执行；如果当前没有事务，则执行类似PROPAGATION_REQUIRED的操作")])])])]),t._v(" "),s("h3",{attrs:{id:"常用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用场景"}},[t._v("#")]),t._v(" 常用场景")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("PROPAGATION_REQUIRED（默认）")])]),t._v(" "),s("ul",[s("li",[t._v("适用于大部分业务场景")]),t._v(" "),s("li",[t._v("确保多个方法在同一事务中执行")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("PROPAGATION_REQUIRES_NEW")])]),t._v(" "),s("ul",[s("li",[t._v("适用于需要独立事务的场景")]),t._v(" "),s("li",[t._v("如记录操作日志，无论主业务是否成功都要保存")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("PROPAGATION_NESTED")])]),t._v(" "),s("ul",[s("li",[t._v("适用于有保存点的场景")]),t._v(" "),s("li",[t._v("子事务回滚不影响父事务，但父事务回滚会影响子事务")])])])]),t._v(" "),s("h3",{attrs:{id:"使用示例-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用示例-2"}},[t._v("#")]),t._v(" 使用示例")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OrderService")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LogService")]),t._v(" logService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用默认的REQUIRED传播行为")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Transactional")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),t._v(" order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 保存订单")]),t._v("\n        orderRepository"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 记录日志（独立事务）")]),t._v("\n        logService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LogService")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用REQUIRES_NEW，确保日志独立保存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Transactional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propagation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Propagation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REQUIRES_NEW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),t._v(" order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setOrderId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setContent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"订单创建"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        logRepository"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),s("p",[t._v("合理使用SpringBoot提供的注解可以大大简化代码，提高开发效率。Lombok注解可以减少样板代码，JSON注解可以控制序列化行为。理解事务传播行为对于处理复杂的业务逻辑非常重要，根据实际需求选择合适的传播行为，可以保证数据的一致性和准确性。")])])}),[],!1,null,null,null);s.default=r.exports}}]);