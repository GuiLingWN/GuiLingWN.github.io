(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{355:function(t,s,a){"use strict";a.r(s);var e=a(27),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"wsl2配置与使用技巧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2配置与使用技巧"}},[t._v("#")]),t._v(" WSL2配置与使用技巧")]),t._v(" "),s("p",[t._v("WSL2（Windows Subsystem for Linux 2）让Windows用户能够直接运行Linux环境。本文整理了WSL2的安装配置、磁盘迁移和网络访问等实用技巧。")]),t._v(" "),s("h2",{attrs:{id:"安装wsl2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装wsl2"}},[t._v("#")]),t._v(" 安装WSL2")]),t._v(" "),s("h3",{attrs:{id:"启用必要的windows功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启用必要的windows功能"}},[t._v("#")]),t._v(" 启用必要的Windows功能")]),t._v(" "),s("p",[s("strong",[t._v("方法一：使用GUI")])]),t._v(" "),s("ol",[s("li",[t._v("按"),s("code",[t._v("Win+R")]),t._v("，输入"),s("code",[t._v("optionalfeatures")]),t._v("打开Windows功能")]),t._v(" "),s("li",[t._v("勾选以下选项：\n"),s("ul",[s("li",[t._v("适用于Linux的Windows子系统")]),t._v(" "),s("li",[t._v("虚拟机平台")])])]),t._v(" "),s("li",[t._v("重启计算机")])]),t._v(" "),s("p",[s("strong",[t._v("方法二：使用PowerShell（管理员）")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用WSL")]),t._v("\ndism"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("online "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enable-feature")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("featurename:Microsoft-Windows-Subsystem-Linux "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("all "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("norestart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用虚拟机平台")]),t._v("\ndism"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("online "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enable-feature")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("featurename:VirtualMachinePlatform "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("all "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("norestart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启系统")]),t._v("\n")])])]),s("h3",{attrs:{id:"安装wsl2-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装wsl2-2"}},[t._v("#")]),t._v(" 安装WSL2")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置WSL2为默认版本")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set-default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("version 2\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列出可用的Linux发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("online\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装Ubuntu（示例）")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04\n")])])]),s("h3",{attrs:{id:"常见安装问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见安装问题"}},[t._v("#")]),t._v(" 常见安装问题")]),t._v(" "),s("p",[s("strong",[t._v("错误代码：0x80070424")])]),t._v(" "),s("p",[t._v("这个错误通常是因为Windows Update服务未运行。")]),t._v(" "),s("p",[t._v("解决方法：")]),t._v(" "),s("ol",[s("li",[t._v("下载最新的WSL2 Linux内核更新包")]),t._v(" "),s("li",[t._v("访问：https://github.com/microsoft/WSL/releases")]),t._v(" "),s("li",[t._v("安装后重试")])]),t._v(" "),s("p",[t._v("参考："),s("a",{attrs:{href:"https://github.com/microsoft/WSL/releases/tag/2.0.11",target:"_blank",rel:"noopener noreferrer"}},[t._v("WSL Release页面"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"磁盘迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#磁盘迁移"}},[t._v("#")]),t._v(" 磁盘迁移")]),t._v(" "),s("p",[t._v("WSL2默认安装在C盘，随着使用会占用大量空间。可以将其迁移到其他盘。")]),t._v(" "),s("h3",{attrs:{id:"迁移步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#迁移步骤"}},[t._v("#")]),t._v(" 迁移步骤")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1. 查看当前WSL发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("verbose\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 导出发行版到tar文件")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("export Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04 D:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ENV/wsl/ubuntu20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04-backup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3. 注销当前发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("unregister Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4. 创建目标目录")]),t._v("\nmkdir D:\\ENV\\wsl\\Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5. 导入到新位置")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("import Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04 D:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ENV/wsl/Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04 D:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ENV/wsl/ubuntu20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04-backup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6. 设置默认用户（重要！）")]),t._v("\nubuntu2004 config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("default-user your_username\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或设置为root")]),t._v("\nubuntu2004 config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("default-user root\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7. 验证迁移成功")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 8. 删除备份文件（可选）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-Item")]),t._v(" D:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ENV/wsl/ubuntu20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04-backup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tar\n")])])]),s("h3",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("默认用户重置：")]),t._v(" 导入后默认用户会变成root，需要手动设置回原用户")]),t._v(" "),s("li",[s("strong",[t._v("备份重要数据：")]),t._v(" 迁移前务必备份重要文件")]),t._v(" "),s("li",[s("strong",[t._v("磁盘空间：")]),t._v(" 确保目标磁盘有足够空间")]),t._v(" "),s("li",[s("strong",[t._v("路径格式：")]),t._v(" 使用正斜杠"),s("code",[t._v("/")]),t._v("或反斜杠"),s("code",[t._v("\\")]),t._v("都可以")])]),t._v(" "),s("h2",{attrs:{id:"网络配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络配置"}},[t._v("#")]),t._v(" 网络配置")]),t._v(" "),s("h3",{attrs:{id:"内网访问wsl2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内网访问wsl2"}},[t._v("#")]),t._v(" 内网访问WSL2")]),t._v(" "),s("p",[t._v("WSL2使用虚拟网络，内网设备默认无法直接访问。需要配置端口转发。")]),t._v(" "),s("h4",{attrs:{id:"方法一-端口转发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法一-端口转发"}},[t._v("#")]),t._v(" 方法一：端口转发")]),t._v(" "),s("p",[t._v("WSL2会动态分配IP地址，需要通过Windows主机转发端口。")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在PowerShell（管理员）中执行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 转发22端口（SSH）")]),t._v("\nnetsh interface portproxy add v4tov4 listenport=22 listenaddress=0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 connectport=22 connectaddress=<WSL2_IP> protocol=tcp\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 转发8091端口（Web服务）")]),t._v("\nnetsh interface portproxy add v4tov4 listenport=8091 listenaddress=0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 connectport=8091 connectaddress=<WSL2_IP> protocol=tcp\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看转发规则")]),t._v("\nnetsh interface portproxy show all\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除转发规则")]),t._v("\nnetsh interface portproxy delete v4tov4 listenport=22 listenaddress=0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0\n")])])]),s("p",[s("strong",[t._v("获取WSL2 IP地址：")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在WSL2中执行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" addr show eth0 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" inet "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $2}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cut")]),t._v(" -d/ "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f1")]),t._v("\n")])])]),s("p",[s("strong",[t._v("注意：")]),t._v(" WSL2重启后IP可能变化，需要重新配置转发。")]),t._v(" "),s("h4",{attrs:{id:"方法二-镜像网络模式-推荐"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法二-镜像网络模式-推荐"}},[t._v("#")]),t._v(" 方法二：镜像网络模式（推荐）")]),t._v(" "),s("p",[t._v("Windows 11或Windows 10新版本支持镜像网络模式，WSL2直接使用主机网络。")]),t._v(" "),s("p",[t._v("编辑"),s("code",[t._v("C:\\Users\\<用户名>\\.wslconfig")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("experimental")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("autoMemoryReclaim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("gradual")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("networkingMode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("mirrored")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("dnsTunneling")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("firewall")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("autoProxy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("sparseVhd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("hostAddressLoopback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("重启WSL：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("wsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("shutdown\n")])])]),s("p",[s("strong",[t._v("优点：")])]),t._v(" "),s("ul",[s("li",[t._v("WSL2使用主机IP，无需端口转发")]),t._v(" "),s("li",[t._v("自动配置DNS和防火墙")]),t._v(" "),s("li",[t._v("支持IPv6")])]),t._v(" "),s("h3",{attrs:{id:"开放windows防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开放windows防火墙"}},[t._v("#")]),t._v(" 开放Windows防火墙")]),t._v(" "),s("p",[t._v("配置端口转发后还需要在防火墙中开放端口：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开放22端口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-NetFirewallRule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("DisplayName "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WSL SSH"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Direction Inbound "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("LocalPort 22 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Protocol TCP "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Action Allow\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开放8091端口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-NetFirewallRule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("DisplayName "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WSL Web"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Direction Inbound "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("LocalPort 8091 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Protocol TCP "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Action Allow\n")])])]),s("p",[t._v("或通过图形界面：")]),t._v(" "),s("ol",[s("li",[t._v('打开"高级安全Windows防火墙"')]),t._v(" "),s("li",[t._v("入站规则 → 新建规则")]),t._v(" "),s("li",[t._v('选择"端口" → 特定本地端口')]),t._v(" "),s("li",[t._v("输入端口号并允许连接")])]),t._v(" "),s("h2",{attrs:{id:"wsl配置优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl配置优化"}},[t._v("#")]),t._v(" WSL配置优化")]),t._v(" "),s("h3",{attrs:{id:"限制资源使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#限制资源使用"}},[t._v("#")]),t._v(" 限制资源使用")]),t._v(" "),s("p",[t._v("编辑"),s("code",[t._v("C:\\Users\\<用户名>\\.wslconfig")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("wsl2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 限制内存为8GB")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("memory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("8GB")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 限制CPU核心数为4")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("processors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("4")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 限制swap空间")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("swap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("2GB")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭页面文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pageReporting")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("false")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置虚拟磁盘最大值")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("experimental")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("sparseVhd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("重启WSL生效：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("wsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("shutdown\n")])])]),s("h3",{attrs:{id:"docker集成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker集成"}},[t._v("#")]),t._v(" Docker集成")]),t._v(" "),s("p",[t._v("WSL2可以作为Docker Desktop的后端：")]),t._v(" "),s("ol",[s("li",[t._v("安装Docker Desktop")]),t._v(" "),s("li",[t._v("设置 → Resources → WSL Integration")]),t._v(" "),s("li",[t._v("启用需要的WSL发行版")])]),t._v(" "),s("p",[s("strong",[t._v("优势：")])]),t._v(" "),s("ul",[s("li",[t._v("Docker容器运行在WSL2中，性能更好")]),t._v(" "),s("li",[t._v("文件系统访问速度快")]),t._v(" "),s("li",[t._v("与Linux环境无缝集成")])]),t._v(" "),s("p",[t._v("参考："),s("a",{attrs:{href:"https://blog.csdn.net/qq_44623314/article/details/126813307",target:"_blank",rel:"noopener noreferrer"}},[t._v("WSL2和Docker安装教程"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),s("h3",{attrs:{id:"wsl管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl管理"}},[t._v("#")]),t._v(" WSL管理")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列出所有发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("all\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列出正在运行的发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("running\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动特定发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭特定发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("terminate Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭所有WSL")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("shutdown\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置默认发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set-default")]),t._v(" Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 转换为WSL2")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set-version")]),t._v(" Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04 2\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 卸载发行版")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("unregister Ubuntu-20"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("04\n")])])]),s("h3",{attrs:{id:"文件访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件访问"}},[t._v("#")]),t._v(" 文件访问")]),t._v(" "),s("p",[s("strong",[t._v("Windows访问WSL文件：")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\\\\wsl$\\Ubuntu-20.04\\home\\username\n")])])]),s("p",[s("strong",[t._v("WSL访问Windows文件：")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /mnt/c/Users/username/Documents\n")])])]),s("h2",{attrs:{id:"性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能优化"}},[t._v("#")]),t._v(" 性能优化")]),t._v(" "),s("h3",{attrs:{id:"使用wsl2文件系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用wsl2文件系统"}},[t._v("#")]),t._v(" 使用WSL2文件系统")]),t._v(" "),s("p",[t._v("文件放在WSL2文件系统中（"),s("code",[t._v("/home")]),t._v("）比放在Windows文件系统（"),s("code",[t._v("/mnt/c")]),t._v("）中性能更好。")]),t._v(" "),s("p",[s("strong",[t._v("推荐做法：")])]),t._v(" "),s("ul",[s("li",[t._v("开发项目放在"),s("code",[t._v("~/projects")])]),t._v(" "),s("li",[t._v("需要Windows访问的文件放在"),s("code",[t._v("/mnt/c")])])]),t._v(" "),s("h3",{attrs:{id:"启用systemd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启用systemd"}},[t._v("#")]),t._v(" 启用systemd")]),t._v(" "),s("p",[t._v("编辑"),s("code",[t._v("/etc/wsl.conf")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("boot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("systemd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("重启WSL生效。")]),t._v(" "),s("h2",{attrs:{id:"常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[t._v("#")]),t._v(" 常见问题")]),t._v(" "),s("h3",{attrs:{id:"wsl2磁盘空间不释放"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2磁盘空间不释放"}},[t._v("#")]),t._v(" WSL2磁盘空间不释放")]),t._v(" "),s("p",[t._v("即使删除文件，虚拟磁盘文件（ext4.vhdx）也不会自动缩小。")]),t._v(" "),s("p",[s("strong",[t._v("解决方法：")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭WSL")]),t._v("\nwsl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("shutdown\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打开PowerShell（管理员）")]),t._v("\ndiskpart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在diskpart中执行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("select")]),t._v(" vdisk file="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\Users\\<用户名>\\AppData\\Local\\Packages\\...\\ext4.vhdx"')]),t._v("\ncompact vdisk\ndetach vdisk\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exit")]),t._v("\n")])])]),s("h3",{attrs:{id:"网络连接问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络连接问题"}},[t._v("#")]),t._v(" 网络连接问题")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查DNS配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/resolv.conf\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 手动设置DNS")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nameserver 8.8.8.8"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/resolv.conf\n")])])]),s("h3",{attrs:{id:"权限问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#权限问题"}},[t._v("#")]),t._v(" 权限问题")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# WSL中访问Windows文件时权限全是777")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以在/etc/wsl.conf中配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("automount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\noptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"metadata,umask=22,fmask=11"')]),t._v("\n")])])]),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/windows/wsl/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WSL官方文档"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://blog.csdn.net/nvd11/article/details/119988309",target:"_blank",rel:"noopener noreferrer"}},[t._v("WSL2网络访问配置"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://blog.csdn.net/qq_44623314/article/details/126813307",target:"_blank",rel:"noopener noreferrer"}},[t._v("WSL2与Docker安装"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);