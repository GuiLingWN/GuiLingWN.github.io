(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{398:function(a,s,t){"use strict";t.r(s);var e=t(27),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"mysql-时区问题与-sql-模式配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-时区问题与-sql-模式配置"}},[a._v("#")]),a._v(" MySQL 时区问题与 SQL 模式配置")]),a._v(" "),s("p",[a._v("在使用 MySQL 数据库时，时区设置和 SQL 模式配置是两个常见但重要的问题。本文将详细介绍如何解决 MySQL 时区问题以及配置 SQL 模式。")]),a._v(" "),s("h2",{attrs:{id:"mysql-时区问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-时区问题"}},[a._v("#")]),a._v(" MySQL 时区问题")]),a._v(" "),s("p",[a._v("时区问题可能导致应用程序与数据库之间的时间数据不一致，影响业务逻辑的正确性。")]),a._v(" "),s("h3",{attrs:{id:"查看当前时区设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看当前时区设置"}},[a._v("#")]),a._v(" 查看当前时区设置")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 查看当前时间")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("NOW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 查看时区相关变量")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SHOW")]),a._v(" VARIABLES "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("LIKE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'%time_zone%'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h3",{attrs:{id:"解决方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[a._v("#")]),a._v(" 解决方法")]),a._v(" "),s("h4",{attrs:{id:"步骤一-修改-java-应用中的时区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤一-修改-java-应用中的时区"}},[a._v("#")]),a._v(" 步骤一：修改 Java 应用中的时区")]),a._v(" "),s("p",[a._v("在 JDBC 连接字符串中设置时区：")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// serverTimezone 可以设置为北京时间 GMT%2B8、上海时间 Asia/Shanghai 或者香港时间 Hongkong")]),a._v("\nurl"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" jdbc"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("test"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),a._v("serverTimezone"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Asia")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Shanghai")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("useUnicode"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("characterEncoding"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("utf8"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("useSSL"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n")])])]),s("h4",{attrs:{id:"步骤二-修改-mysql-数据库的时区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤二-修改-mysql-数据库的时区"}},[a._v("#")]),a._v(" 步骤二：修改 MySQL 数据库的时区")]),a._v(" "),s("p",[s("strong",[a._v("方法一：使用命令（临时设置）")])]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 设置当前会话时区")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SET")]),a._v(" time_zone "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'+8:00'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 设置全局时区")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SET")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("GLOBAL")]),a._v(" time_zone "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'+8:00'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 刷新权限")]),a._v("\nFLUSH "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("PRIVILEGES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("优点：不需要重启 MySQL 服务\n缺点：一旦 MySQL 服务重启，设置就会消失")]),a._v(" "),s("p",[s("strong",[a._v("方法二：修改配置文件（永久设置）")]),a._v("\n在 MySQL 配置文件中添加：")]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("mysqld")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置默认时区")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("default-time_zone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("'"),s("span",{pre:!0,attrs:{class:"token inner-value"}},[a._v("+8:00")]),a._v("'")]),a._v("\n")])])]),s("p",[a._v("优点：永久保存设置\n缺点：需要重启 MySQL 服务才能生效")]),a._v(" "),s("h3",{attrs:{id:"docker-环境下的时区配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-环境下的时区配置"}},[a._v("#")]),a._v(" Docker 环境下的时区配置")]),a._v(" "),s("p",[a._v("在 Docker 环境中，可以通过以下方式修改时区配置：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 复制本地配置文件到容器中，覆盖容器内部的 my.cnf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /root/my.cnf container_id:/etc/mysql/\n")])])]),s("h2",{attrs:{id:"sql-模式配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sql-模式配置"}},[a._v("#")]),a._v(" SQL 模式配置")]),a._v(" "),s("p",[a._v("MySQL 的 SQL 模式（sql_mode）定义了 MySQL 应该支持的 SQL 语法和应该执行的数据验证检查。")]),a._v(" "),s("h3",{attrs:{id:"only-full-group-by-问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#only-full-group-by-问题"}},[a._v("#")]),a._v(" ONLY_FULL_GROUP_BY 问题")]),a._v(" "),s("p",[a._v("在使用 GROUP BY 语句时，可能会遇到以下错误：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("this is incompatible with sql_mode=only_full_group_by\n")])])]),s("h3",{attrs:{id:"解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[a._v("#")]),a._v(" 解决方案")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 查看当前全局 SQL 模式")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),a._v(" @"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@GLOBAL.sql_mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 设置新的 SQL 模式（移除 ONLY_FULL_GROUP_BY）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SET")]),a._v(" @"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@global.sql_mode")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h3",{attrs:{id:"常见的-sql-模式选项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见的-sql-模式选项"}},[a._v("#")]),a._v(" 常见的 SQL 模式选项")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("STRICT_TRANS_TABLES")]),a._v("：对事务性存储引擎启用严格模式")]),a._v(" "),s("li",[s("code",[a._v("NO_ZERO_IN_DATE")]),a._v("：不允许日期中的零值")]),a._v(" "),s("li",[s("code",[a._v("NO_ZERO_DATE")]),a._v("：不允许 '0000-00-00' 日期")]),a._v(" "),s("li",[s("code",[a._v("ERROR_FOR_DIVISION_BY_ZERO")]),a._v("：除零时产生错误而不是警告")]),a._v(" "),s("li",[s("code",[a._v("NO_AUTO_CREATE_USER")]),a._v("：禁止 GRANT 自动创建用户")]),a._v(" "),s("li",[s("code",[a._v("NO_ENGINE_SUBSTITUTION")]),a._v("：当指定的存储引擎不可用时产生错误")])]),a._v(" "),s("h2",{attrs:{id:"字符集排序规则问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#字符集排序规则问题"}},[a._v("#")]),a._v(" 字符集排序规则问题")]),a._v(" "),s("p",[a._v("在处理不同字符集的数据时，可能会遇到排序规则不匹配的问题。")]),a._v(" "),s("h3",{attrs:{id:"错误信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误信息"}},[a._v("#")]),a._v(" 错误信息")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_0900_ai_ci,IMPLICIT) for operation '='\n")])])]),s("h3",{attrs:{id:"解决方法-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-2"}},[a._v("#")]),a._v(" 解决方法")]),a._v(" "),s("p",[a._v("在查询中显式指定排序规则：")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" table1 t1 \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("JOIN")]),a._v(" table2 t2 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ON")]),a._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("column")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COLLATE")]),a._v(" utf8mb4_general_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" t2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("column")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h3",{attrs:{id:"版本兼容性问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#版本兼容性问题"}},[a._v("#")]),a._v(" 版本兼容性问题")]),a._v(" "),s("p",[a._v("从 MySQL 8.0 向低版本导入数据时，可能会遇到字符集兼容性问题：")]),a._v(" "),s("p",[a._v("解决方法：")]),a._v(" "),s("ol",[s("li",[a._v("将文件中的所有 "),s("code",[a._v("utf8mb4_0900_ai_ci")]),a._v(" 替换为 "),s("code",[a._v("utf8mb4_general_ci")])]),a._v(" "),s("li",[a._v("将 "),s("code",[a._v("utf8mb4")]),a._v(" 替换为 "),s("code",[a._v("utf8")])])]),a._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),s("p",[a._v("正确配置 MySQL 的时区和 SQL 模式对于确保数据的一致性和应用的稳定性非常重要。在实际使用中，应根据具体需求选择合适的配置方式，并注意以下几点：")]),a._v(" "),s("ol",[s("li",[a._v("合理设置时区，确保应用与数据库时间一致")]),a._v(" "),s("li",[a._v("根据业务需求配置 SQL 模式")]),a._v(" "),s("li",[a._v("注意字符集和排序规则的兼容性")]),a._v(" "),s("li",[a._v("在 Docker 环境中正确处理配置文件")]),a._v(" "),s("li",[a._v("定期检查和优化数据库配置")])]),a._v(" "),s("p",[a._v("通过合理配置这些参数，可以避免很多常见的数据库问题，提高系统的稳定性和可靠性。")])])}),[],!1,null,null,null);s.default=r.exports}}]);