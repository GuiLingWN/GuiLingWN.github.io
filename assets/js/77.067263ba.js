(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{390:function(a,s,t){"use strict";t.r(s);var e=t(27),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"mongodb数据备份与恢复指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongodb数据备份与恢复指南"}},[a._v("#")]),a._v(" MongoDB数据备份与恢复指南")]),a._v(" "),s("p",[a._v("在日常的数据库运维工作中，数据备份与恢复是非常重要的环节。MongoDB提供了多种数据备份与恢复的工具和方法，本文将详细介绍这些工具的使用方式。")]),a._v(" "),s("h2",{attrs:{id:"数据备份工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据备份工具"}},[a._v("#")]),a._v(" 数据备份工具")]),a._v(" "),s("h3",{attrs:{id:"mongodump-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongodump-命令"}},[a._v("#")]),a._v(" mongodump 命令")]),a._v(" "),s("p",[a._v("mongodump 是 MongoDB 自带的数据备份工具，可以将数据导出为 BSON 格式。")]),a._v(" "),s("p",[a._v("基本命令格式：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mongodump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" IP "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" 端口 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" 用户名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 密码 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" 数据库 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" 文件存在路径\n")])])]),s("p",[a._v("如果想导出所有数据库，可以省略 "),s("code",[a._v("-d")]),a._v(" 参数。")]),a._v(" "),s("p",[a._v("示例：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mongodump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30216")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" xxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" xxxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" home/mongodb/\n")])])]),s("h3",{attrs:{id:"mongoexport-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongoexport-命令"}},[a._v("#")]),a._v(" mongoexport 命令")]),a._v(" "),s("p",[a._v("mongoexport 可以将数据导出为 JSON 或 CSV 格式，更适合与其他系统进行数据交换。")]),a._v(" "),s("p",[a._v("基本命令格式：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mongoexport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" IP "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" 端口 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" 用户名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 密码 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" 数据库 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" 表名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" 字段\n")])])]),s("p",[a._v("常用参数说明：")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("-f")]),a._v("：指定导出的字段，以逗号分隔")]),a._v(" "),s("li",[s("code",[a._v("-q")]),a._v("：指定查询条件导出数据")]),a._v(" "),s("li",[s("code",[a._v("--csv")]),a._v("：指定导出为 CSV 格式")])]),a._v(" "),s("p",[a._v("示例：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导出整张表")]),a._v("\nmongoexport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("users")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" /home/mongodb/test/users.dat\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导出部分字段")]),a._v("\nmongoexport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("users")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--csv")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" uid,name,sex "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" test/users.csv\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 根据条件导出数据")]),a._v("\nmongoexport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("users")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-q")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{uid:{$gt:1}}'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" test/users.json\n")])])]),s("h2",{attrs:{id:"数据恢复工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据恢复工具"}},[a._v("#")]),a._v(" 数据恢复工具")]),a._v(" "),s("h3",{attrs:{id:"mongorestore-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongorestore-命令"}},[a._v("#")]),a._v(" mongorestore 命令")]),a._v(" "),s("p",[a._v("mongorestore 用于恢复由 mongodump 备份的数据。")]),a._v(" "),s("p",[a._v("基本命令格式：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mongorestore "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" IP "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" 端口 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" 用户名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 密码 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" 数据库 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--drop")]),a._v(" 文件存在路径\n")])])]),s("p",[a._v("示例：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mongorestore "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" /home/mongodb/test\n")])])]),s("h3",{attrs:{id:"mongoimport-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongoimport-命令"}},[a._v("#")]),a._v(" mongoimport 命令")]),a._v(" "),s("p",[a._v("mongoimport 用于导入由 mongoexport 导出的数据。")]),a._v(" "),s("p",[a._v("基本命令格式：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 还原整表导出的非csv文件")]),a._v("\nmongoimport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" IP "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" 端口 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" 用户名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 密码 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" 数据库 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" 表名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--upsert")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--drop")]),a._v(" 文件名\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 还原部分字段的导出文件")]),a._v("\nmongoimport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" IP "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" 端口 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" 用户名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 密码 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" 数据库 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" 表名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--upsertFields")]),a._v(" 字段 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--drop")]),a._v(" 文件名\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 还原导出的csv文件")]),a._v("\nmongoimport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" IP "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" 端口 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" 用户名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 密码 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" 数据库 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" 表名 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--type")]),a._v(" 类型 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--headerline")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--upsert")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--drop")]),a._v(" 文件名\n")])])]),s("p",[a._v("示例：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 还原导出的表数据")]),a._v("\nmongoimport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("users")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--upsert")]),a._v(" test/users.dat\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 还原csv文件")]),a._v("\nmongoimport "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("users")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--type")]),a._v(" csv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--headerline")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--file")]),a._v(" test/users.csv\n")])])]),s("h2",{attrs:{id:"mongodb-服务管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-服务管理"}},[a._v("#")]),a._v(" MongoDB 服务管理")]),a._v(" "),s("h3",{attrs:{id:"启动-mongodb-服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-mongodb-服务器"}},[a._v("#")]),a._v(" 启动 MongoDB 服务器")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定数据存储路径启动")]),a._v("\nF:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("mongodb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("mongod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dbpath")]),a._v(" F:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("mongodb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("db\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或者通过配置文件启动")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"F:\\mongodb'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[a._v("\\b")]),a._v('in\\mongod.exe"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"F:\\mongodb\\mongod.cfg"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v("\n")])])]),s("h3",{attrs:{id:"连接-mongodb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#连接-mongodb"}},[a._v("#")]),a._v(" 连接 MongoDB")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("mongodb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("mongo.exe\n")])])]),s("h2",{attrs:{id:"特殊场景-yapi-数据恢复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特殊场景-yapi-数据恢复"}},[a._v("#")]),a._v(" 特殊场景：YAPI 数据恢复")]),a._v(" "),s("p",[a._v("在使用 Docker 部署的 YAPI 环境中，可以通过以下步骤恢复数据：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将备份数据复制到容器中")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" /root/yapi/ mongo:/root/yapi/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 执行数据恢复")]),a._v("\nmongorestore "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" admin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--authenticationDatabase")]),a._v(" admin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" yapi /root/yapi\n")])])]),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),s("p",[a._v("MongoDB 提供了完整的数据备份与恢复解决方案，通过合理使用这些工具，可以有效保障数据安全。在实际操作中，建议根据具体需求选择合适的工具和参数，定期进行数据备份，并验证恢复流程的有效性。")])])}),[],!1,null,null,null);s.default=r.exports}}]);