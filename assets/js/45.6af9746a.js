(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{358:function(s,a,e){"use strict";e.r(a);var t=e(27),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"linux-用户与用户组管理核心命令速查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-用户与用户组管理核心命令速查"}},[s._v("#")]),s._v(" Linux 用户与用户组管理核心命令速查")]),s._v(" "),a("p",[s._v("作为 Linux 系统管理员，用户和用户组的管理是绕不开的基础操作。无论是为新同事创建账号、分配权限，还是进行安全加固，我们都需要与一系列命令打交道。这篇文章是我个人整理的一份备忘录，汇总了在日常工作中常用的用户与用户组管理命令，希望能帮助大家快速查找和回顾。")]),s._v(" "),a("h2",{attrs:{id:"一、用户管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、用户管理"}},[s._v("#")]),s._v(" 一、用户管理")]),s._v(" "),a("h3",{attrs:{id:"_1-创建新用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建新用户"}},[s._v("#")]),s._v(" 1. 创建新用户")]),s._v(" "),a("p",[s._v("在 Linux 中，创建用户通常有两种方式："),a("code",[s._v("adduser")]),s._v(" 和 "),a("code",[s._v("useradd")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[s._v("adduser")]),s._v(" (推荐)")]),s._v("：这是一个交互式的脚本，使用起来非常友好。它会在创建用户的同时，自动创建家目录、设置密码，并引导你填写一些额外信息。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建一个名为 phpq 的用户")]),s._v("\nadduser phpq\n")])])])]),s._v(" "),a("li",[a("p",[a("strong",[a("code",[s._v("useradd")])]),s._v("：这是一个更底层的命令，适合在脚本中使用，可以配合参数一次性完成配置。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建 phpq 用户并将其主工作组设置为已存在的 test 组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" phpq\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为新用户设置密码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" phpq\n")])])]),a("p",[a("code",[s._v("useradd")]),s._v(" 的常用参数：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-g")]),s._v("：指定用户所属的主工作组。")]),s._v(" "),a("li",[a("code",[s._v("-d")]),s._v("：指定用户的家目录。")]),s._v(" "),a("li",[a("code",[s._v("-s")]),s._v("：指定用户登录后使用的 Shell。")])])])]),s._v(" "),a("h3",{attrs:{id:"_2-修改用户信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改用户信息"}},[s._v("#")]),s._v(" 2. 修改用户信息")]),s._v(" "),a("p",[s._v("最常见的修改操作是为用户添加附加工作组。")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[s._v("usermod")])]),s._v("：这是修改用户属性的强大工具。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将用户 username 添加到 groupname 组中，同时保留其原有的附加组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aG")]),s._v(" groupname username\n")])])]),a("p",[a("strong",[s._v("注意")]),s._v("：这里的 "),a("code",[s._v("-a")]),s._v("（append）参数至关重要。如果只使用 "),a("code",[s._v("usermod -G groupname username")]),s._v("，该用户会从其他所有附加组中被移除，只保留 "),a("code",[s._v("groupname")]),s._v(" 这个组，这通常不是我们想要的结果。")])]),s._v(" "),a("li",[a("p",[a("strong",[a("code",[s._v("gpasswd")])]),s._v("：这是专门管理用户组的命令，也可以用来向组中添加成员。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同样是将用户 user 添加到 group 组中")]),s._v("\ngpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" user group\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_3-临时锁定与解锁用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-临时锁定与解锁用户"}},[s._v("#")]),s._v(" 3. 临时锁定与解锁用户")]),s._v(" "),a("p",[s._v("如果希望临时禁止某个用户登录，而不是直接删除，可以使用 "),a("code",[s._v("passwd")]),s._v(" 命令进行锁定。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 锁定 peter 用户的账号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" peter\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解锁 peter 用户的账号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" peter\n")])])]),a("blockquote",[a("p",[a("strong",[s._v("小技巧")]),s._v("：其原理是在 "),a("code",[s._v("/etc/shadow")]),s._v(" 文件中对应用户的加密密码串前添加一个 "),a("code",[s._v("!")]),s._v(" 或 "),a("code",[s._v("*")]),s._v("。手动编辑虽然也能实现，但不如使用 "),a("code",[s._v("passwd")]),s._v(" 命令来得安全方便。")])]),s._v(" "),a("h3",{attrs:{id:"_4-永久删除用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-永久删除用户"}},[s._v("#")]),s._v(" 4. 永久删除用户")]),s._v(" "),a("p",[s._v("当用户确定不再需要时，可以使用 "),a("code",[s._v("userdel")]),s._v(" 命令进行删除。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅删除用户 peter，但保留其家目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("userdel")]),s._v(" peter\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除用户的同时，也删除其家目录和邮件池（-r 代表 --remove）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("userdel")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" peter\n")])])]),a("h2",{attrs:{id:"二、用户组管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、用户组管理"}},[s._v("#")]),s._v(" 二、用户组管理")]),s._v(" "),a("h3",{attrs:{id:"_1-创建与删除用户组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建与删除用户组"}},[s._v("#")]),s._v(" 1. 创建与删除用户组")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建一个名为 test 的工作组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 test 工作组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupdel")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-从用户组中删除用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-从用户组中删除用户"}},[s._v("#")]),s._v(" 2. 从用户组中删除用户")]),s._v(" "),a("p",[s._v("可以使用 "),a("code",[s._v("gpasswd")]),s._v(" 命令的 "),a("code",[s._v("-d")]),s._v(" 选项。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 group 组中移除用户 user")]),s._v("\ngpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" user group\n")])])]),a("blockquote",[a("p",[s._v("另外一种方式是直接编辑 "),a("code",[s._v("/etc/group")]),s._v(" 文件，找到对应的组，从成员列表中删除该用户名即可。但同样，直接使用命令是更推荐的做法。")])]),s._v(" "),a("h2",{attrs:{id:"三、查看用户信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、查看用户信息"}},[s._v("#")]),s._v(" 三、查看用户信息")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[s._v("id")]),s._v(" 命令")]),s._v("：显示指定用户的 UID（用户ID）、GID（主组ID）以及所属的所有用户组。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" username\n")])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("查看密码文件")]),s._v("："),a("code",[s._v("/etc/passwd")]),s._v(" 文件存储了系统所有用户的信息（但不含密码）。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/passwd\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"四、sudo-权限配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、sudo-权限配置"}},[s._v("#")]),s._v(" 四、Sudo 权限配置")]),s._v(" "),a("p",[s._v("有时我们希望某个组的用户都能免密切换到另一个公共账号下执行操作。这可以通过配置 "),a("code",[s._v("sudoers")]),s._v(" 实现。")]),s._v(" "),a("p",[s._v("一个好的实践是在 "),a("code",[s._v("/etc/sudoers.d/")]),s._v(" 目录下创建一个新的配置文件（例如，"),a("code",[s._v("touch /etc/sudoers.d/my-sudo-rules")]),s._v("），而不是直接修改主文件 "),a("code",[s._v("/etc/sudoers")]),s._v("。")]),s._v(" "),a("p",[s._v("例如，允许 "),a("code",[s._v("etl")]),s._v(" 组的所有成员都能免密码切换到 "),a("code",[s._v("etl")]),s._v(" 用户：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 文件：/etc/sudoers.d/etl-permissions\n\n%etl ALL=(ALL) NOPASSWD: /bin/su etl\n%etl ALL=(ALL) NOPASSWD: /bin/su - etl\n")])])]),a("p",[s._v("这里的 "),a("code",[s._v("%etl")]),s._v(" 表示 "),a("code",[s._v("etl")]),s._v(" 用户组。这条规则意味着，"),a("code",[s._v("etl")]),s._v(" 组的任何成员在任何主机上（第一个 "),a("code",[s._v("ALL")]),s._v("）都可以作为任何用户（第二个 "),a("code",[s._v("ALL")]),s._v("）免密码（"),a("code",[s._v("NOPASSWD")]),s._v("）执行后面的命令。")]),s._v(" "),a("p",[s._v("关于 "),a("code",[s._v("sudo")]),s._v(" 的更详细配置，可以参考这篇详细的文章："),a("a",{attrs:{href:"http://www.cnblogs.com/xd502djj/p/6641475.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sudoers 文件配置详解"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("希望这份笔记能成为你管理 Linux 系统时的得力助手！")])])}),[],!1,null,null,null);a.default=r.exports}}]);