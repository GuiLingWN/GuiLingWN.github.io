(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{381:function(a,t,s){"use strict";s.r(t);var e=s(27),v=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[a._v("#")]),a._v(" 前言")]),a._v(" "),t("p",[a._v("在配置华为云服务器时，我们有时会遇到应用程序需要使用 UDP 协议进行通信，却发现端口不通的情况。这在需要进行实时数据传输、在线游戏或特定网络服务的场景中尤为常见。本文将详细介绍在华为云环境中，如何一步步诊断并解决 UDP 端口不通的问题。")]),a._v(" "),t("h2",{attrs:{id:"一、问题诊断-测试-udp-端口连通性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、问题诊断-测试-udp-端口连通性"}},[a._v("#")]),a._v(" 一、问题诊断：测试 UDP 端口连通性")]),a._v(" "),t("p",[a._v("在着手解决问题之前，首先要确认 UDP 端口是否真的无法访问。我们可以使用强大的网络工具 "),t("code",[a._v("nc")]),a._v("（Netcat）来进行快速诊断。")]),a._v(" "),t("h3",{attrs:{id:"_1-扫描目标服务器的-udp-端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-扫描目标服务器的-udp-端口"}},[a._v("#")]),a._v(" 1. 扫描目标服务器的 UDP 端口")]),a._v(" "),t("p",[a._v("你可以从另一台设备上，使用以下命令扫描服务器的指定 UDP 端口范围，查看其状态。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 扫描服务器 IP 的 12580 到 12590 的 UDP 端口")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nc")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zv")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("你的服务器公网IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12580")]),a._v("-12590\n")])])]),t("ul",[t("li",[t("code",[a._v("z")]),a._v(": 表示零 I/O 模式，仅报告端口状态而不发送数据。")]),a._v(" "),t("li",[t("code",[a._v("v")]),a._v(": 表示详细模式，输出更多调试信息。")]),a._v(" "),t("li",[t("code",[a._v("u")]),a._v(": 表示使用 UDP 协议。")])]),a._v(" "),t("h3",{attrs:{id:"_2-在服务器上监听-udp-端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-在服务器上监听-udp-端口"}},[a._v("#")]),a._v(" 2. 在服务器上监听 UDP 端口")]),a._v(" "),t("p",[a._v("在你的华为云服务器上，执行以下命令，监听一个具体的 UDP 端口（例如 "),t("code",[a._v("12589")]),a._v("），看是否能接收到数据。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 监听 12589 UDP 端口")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nc")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ul")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12589")]),a._v("\n")])])]),t("h3",{attrs:{id:"_3-从客户端发送测试消息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-从客户端发送测试消息"}},[a._v("#")]),a._v(" 3. 从客户端发送测试消息")]),a._v(" "),t("p",[a._v("同时，在你的本地机器或另一台服务器上，向该端口发送一条测试消息。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# 向服务器的 12589 UDP 端口发送 "test" 消息')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"test"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nc")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("你的服务器公网IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12589")]),a._v("\n")])])]),t("p",[a._v('如果在服务器的监听窗口中看到了 "test" 字样，说明网络是通的。反之，如果什么也收不到，那么多半是服务器的防火墙或安全组策略阻止了 UDP 流量。')]),a._v(" "),t("h2",{attrs:{id:"二、问题排查与解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、问题排查与解决方案"}},[a._v("#")]),a._v(" 二、问题排查与解决方案")]),a._v(" "),t("p",[a._v("当确认 UDP 流量被服务器拦截后，我们通常会首先检查传统的防火墙工具，如 "),t("code",[a._v("iptables")]),a._v("。")]),a._v(" "),t("h3",{attrs:{id:"_1-初步排查-检查-iptables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-初步排查-检查-iptables"}},[a._v("#")]),a._v(" 1. 初步排查：检查 "),t("code",[a._v("iptables")])]),a._v(" "),t("p",[a._v("很多有经验的管理员会先用 "),t("code",[a._v("iptables -L -n")]),a._v(" 查看规则。但在某些情况下，即使 "),t("code",[a._v("iptables")]),a._v(" 规则看起来完全正确（甚至为空），端口依然不通。这就引出了一个常见却容易被忽略的问题：系统可能正在使用 "),t("code",[a._v("firewalld")]),a._v(" 作为主要的防火墙管理工具。")]),a._v(" "),t("p",[a._v("在一些现代 Linux 发行版中，"),t("code",[a._v("firewalld")]),a._v(" 服务会作为 "),t("code",[a._v("iptables")]),a._v(" 的前端管理工具运行。即使 "),t("code",[a._v("iptables")]),a._v(" 规则看似开放，"),t("code",[a._v("firewalld")]),a._v(" 的默认策略（如 "),t("code",[a._v("public")]),a._v(" 区域的默认设置为拒绝）仍会阻止未经许可的流量。")]),a._v(" "),t("h3",{attrs:{id:"_2-最终解决-配置-firewalld"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-最终解决-配置-firewalld"}},[a._v("#")]),a._v(" 2. 最终解决：配置 "),t("code",[a._v("firewalld")])]),a._v(" "),t("p",[a._v("因此，在确认 "),t("code",[a._v("iptables")]),a._v(" 没有问题后，我们需要检查并配置 "),t("code",[a._v("firewalld")]),a._v("。")]),a._v(" "),t("p",[a._v("执行以下命令来开放 "),t("code",[a._v("12580")]),a._v(" 到 "),t("code",[a._v("12590")]),a._v(" 的 UDP 端口：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1. 将 UDP 端口范围添加到 public 区域，并设为永久规则")]),a._v("\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("public --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12580")]),a._v("-12590/udp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2. 重新加载防火墙配置，使新规则生效")]),a._v("\nfirewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--reload")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 3. (可选) 查看所有已应用的规则，确认端口已成功开放")]),a._v("\nfirewall-cmd --list-all\n")])])]),t("p",[t("strong",[a._v("命令解释：")])]),a._v(" "),t("ul",[t("li",[t("code",[a._v("--zone=public")]),a._v(": 指定将规则应用到 "),t("code",[a._v("public")]),a._v(" 网络区域，这是默认的外部网络接口区域。")]),a._v(" "),t("li",[t("code",[a._v("--add-port=12580-12590/udp")]),a._v(": 指定要开放的 UDP 端口范围。")]),a._v(" "),t("li",[t("code",[a._v("--permanent")]),a._v(": 将此规则设为永久性，这样服务器重启后规则依然有效。")])]),a._v(" "),t("p",[a._v("完成以上步骤后，再次按照第一部分的方法进行测试，你应该会发现 UDP 端口已经可以正常通信了。")]),a._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),t("p",[a._v("解决华为云服务器 UDP 端口不通的问题通常分为两步：首先使用 "),t("code",[a._v("nc")]),a._v(" 等工具进行准确诊断，定位问题所在；然后根据服务器的防火墙配置（先检查 "),t("code",[a._v("iptables")]),a._v("，再深入排查 "),t("code",[a._v("firewalld")]),a._v("）来配置正确的放行规则。")]),a._v(" "),t("p",[t("strong",[a._v("重要提示")]),a._v("：除了服务器内部的防火墙，不要忘记检查华为云平台提供的 "),t("strong",[a._v("安全组")]),a._v(" 配置。安全组是实例级别的虚拟防火墙，如果其入方向规则没有允许对应的 UDP 端口，流量同样会被拦截。因此，你需要确保服务器防火墙和安全组两个层面都已正确放行。")])])}),[],!1,null,null,null);t.default=v.exports}}]);